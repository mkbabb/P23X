Microsoft (R) Macro Assembler Version 6.11		    04/12/21 02:01:06
rlc.asm							     Page 1 - 1


				;---------------------------------------------------------------------
				;  Program:      Run Length Coding
				;
				;  Function:     Decompresses 1 dimensional run lengths
				;                This subroutine links with a C main program
				;
				;                Add your additional functional comments
				;
				;  Owner:
				;
				;  Changes:
				;  Date          Reason
				;  ----          ------
				;  05/16/2017    Original version ... coded to spec design
				;---------------------------------------------------------------------
				         .model    small
				         .8086
				         public    _rlc
				;---------------------------------------
 0000				         .data                         ;start the data segment
				;---------------------------------------
 0000  0002 [			    run         db 2 dup (?)           
        00
       ]
 0002 50			    pels_left   db 80
				;---------------------------------------
 0000				         .code                         ;start the code segnment
				;---------------------------------------
				; Save the registers ... 'C' requires (bp,si,di)
				; Access the input and output lists
				;---------------------------------------
 0000				_rlc:                                  ;
 0000  55			    push      bp                  ;save 'C' register
 0001  8B EC			    mov       bp,sp               ;set bp to point to stack
 0003  56			    push      si                  ;save 'C' register
 0004  57			    push      di                  ;save 'C' register
 0005  8B 76 04			    mov       si, [bp + 4]           ;si points to the input compressed data
 0008  8B 7E 06			    mov       di, [bp + 6]           ;di points to the empty output buffer

 000B				cur_set:
 000B  B2 20			    mov dl, 32
				;---------------------------------------
 000D				main_body:
 000D  8A 04			    mov al, byte ptr [si]; al = code
 000F  46			    inc si

 0010  3C 00			    cmp al, 0
 0012  74 4B			    je exit

 0014  8A E0			    mov ah, al

 0016  B1 04			    mov cl, 4
 0018  D2 E8			    shr al, cl
				    
 001A  80 E4 0F			    and ah, 0fh

 001D  A2 0000 R		    mov [run], al
 0020  88 26 0001 R		    mov [run + 1], ah

 0024  33 DB			    xor bx, bx ; i variable
 0026  33 C9			    xor cx, cx ; len variable

 0028				for_loop:
 0028  83 FB 02			    cmp bx, 2
 002B  7D E0			    jge main_body
 002D  43			    inc bx

 002E				pels_left_test:
 002E  80 3E 0002 R 00		    cmp [pels_left], 0
 0033  75 07			    jne run_test

 0035  C6 06 0002 R 50		    mov [pels_left], 80
 003A  B2 20			    mov dl, 32

 003C				run_test:
 003C  80 BF 0000 R 0F		    cmp [run + bx], 15
 0041  74 06			    je run_test_if
 0043  8A 8F 0000 R		    mov cl, [run + bx]
 0047  EB 04			    jmp while_loop
 0049				run_test_if:
 0049  8A 0E 0002 R		    mov cl, [pels_left]
 004D				while_loop: 
 004D  88 15			    mov byte ptr [di], dl
 004F  47			    inc di
 0050  FE 0E 0002 R		    dec [pels_left]
 0054  E2 F7			    loop while_loop

 0056				cur_test:
 0056  80 FA 20			    cmp dl, 32
 0059  75 B0			    jne cur_set
 005B  B2 DB			    mov dl, 219
 005D  EB AE			    jmp main_body
				;---------------------------------------
				; Restore registers and return
				;---------------------------------------
 005F				exit:                                  ;
 005F  5F			    pop       di                  ;restore 'C' register
 0060  5E			    pop       si                  ;restore 'C' register
 0061  5D			    pop       bp                  ;restore 'C' register
 0062  C3			    ret                           ;return
				;---------------------------------------
				    end

 
Microsoft (R) Macro Assembler Version 6.11		    04/12/21 02:01:06
rlc.asm							     Symbols 2 - 1




Segments and Groups:

                N a m e                 Size     Length   Align   Combine Class

DGROUP . . . . . . . . . . . . .	GROUP
_DATA  . . . . . . . . . . . . .	16 Bit	 0003	  Word	  Public  'DATA'	
_TEXT  . . . . . . . . . . . . .	16 Bit	 0063	  Word	  Public  'CODE'	


Symbols:

                N a m e                 Type     Value    Attr

@CodeSize  . . . . . . . . . . .	Number	 0000h	 
@DataSize  . . . . . . . . . . .	Number	 0000h	 
@Interface . . . . . . . . . . .	Number	 0000h	 
@Model . . . . . . . . . . . . .	Number	 0002h	 
@code  . . . . . . . . . . . . .	Text   	 _TEXT
@data  . . . . . . . . . . . . .	Text   	 DGROUP
@fardata?  . . . . . . . . . . .	Text   	 FAR_BSS
@fardata . . . . . . . . . . . .	Text   	 FAR_DATA
@stack . . . . . . . . . . . . .	Text   	 DGROUP
_rlc . . . . . . . . . . . . . .	L Near	 0000	  _TEXT	Public
cur_set  . . . . . . . . . . . .	L Near	 000B	  _TEXT	
cur_test . . . . . . . . . . . .	L Near	 0056	  _TEXT	
exit . . . . . . . . . . . . . .	L Near	 005F	  _TEXT	
for_loop . . . . . . . . . . . .	L Near	 0028	  _TEXT	
main_body  . . . . . . . . . . .	L Near	 000D	  _TEXT	
pels_left_test . . . . . . . . .	L Near	 002E	  _TEXT	
pels_left  . . . . . . . . . . .	Byte	 0002	  _DATA	
run_test_if  . . . . . . . . . .	L Near	 0049	  _TEXT	
run_test . . . . . . . . . . . .	L Near	 003C	  _TEXT	
run  . . . . . . . . . . . . . .	Byte	 0000	  _DATA	
while_loop . . . . . . . . . . .	L Near	 004D	  _TEXT	

	   0 Warnings
	   0 Errors
